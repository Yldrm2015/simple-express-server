<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Detection Test</title>
</head>
<body>
    <h1>Bot Detection Test</h1>

    <p><strong>Sunucu Tespiti:</strong> âœ… Not a bot.</p>
    <p id="browser-info">Detecting Browser...</p>
    <p id="request-id">Request ID: Waiting...</p>
    <p id="visitor-id">Visitor ID: Waiting...</p>
    <p id="js-detection">JavaScript Detection: Checking...</p>

    <noscript>
        <p style="color: yellow; font-weight: bold;">âš ï¸ JavaScript is disabled! Only server-side detection is active.</p>
    </noscript>

    <script>
        async function detectBrowser() {
            const userAgent = navigator.userAgent;
            let browserName = "Unknown";
            let browserIcon = "â“";

            // **ğŸ¦ Brave Tespiti (Kesin Ã‡Ã¶zÃ¼m!)**
            let isBrave = false;
            if (navigator.brave !== undefined) {
                isBrave = await navigator.brave.isBrave();
            }

            if (isBrave) {
                browserName = "Brave";
                browserIcon = "ğŸ¦";
            } else if (userAgent.includes("Edg")) {
                browserName = "Microsoft Edge";
                browserIcon = "ğŸŒ";
            } else if (userAgent.includes("OPR") || userAgent.includes("Opera")) {
                browserName = "Opera";
                browserIcon = "ğŸ­";
            } else if (userAgent.includes("Firefox")) {
                browserName = "Mozilla Firefox";
                browserIcon = "ğŸ¦Š";
            } else if (userAgent.includes("Safari") && !userAgent.includes("Chrome")) {
                browserName = "Safari";
                browserIcon = "ğŸ";
            } else if (userAgent.includes("Chrome")) {
                browserName = "Google Chrome";
                browserIcon = "ğŸŒ";
            }

            // **TarayÄ±cÄ± bilgisini ekrana yazdÄ±r**
            document.getElementById("browser-info").innerHTML = `<strong>Browser Info:</strong> ${browserIcon} ${browserName}`;
        }

        // **FingerprintJS ile Bot Tespiti ve Request ID / Visitor ID Alma**
        async function detectBotD() {
            try {
                console.log("ğŸ”„ [INFO] Fetching BotD fingerprint...");

                const fpPromise = import('https://fpjscdn.net/v3/b80bbum6BTT6MT2eIb5B')
                    .then(FingerprintJS => FingerprintJS.load());

                const fp = await fpPromise;
                const result = await fp.get();

                const requestId = result.requestId;
                const visitorId = result.visitorId;

                document.getElementById("request-id").innerText = "Request ID: " + requestId;
                document.getElementById("visitor-id").innerText = "Visitor ID: " + visitorId;

                console.log("ğŸ“¡ [BOTD] Sending Request ID to server:", requestId);

                fetch('/botd-test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ requestId, visitorId })
                })
                .then(response => response.json())
                .then(data => {
                    console.log("âœ… [BOTD SUCCESS]:", data);
                    document.getElementById("js-detection").innerText = "JavaScript Detection: " + JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    console.error("âŒ [BOTD ERROR]:", error);
                    document.getElementById("js-detection").innerText = "BotD Error: " + error.message;
                });

            } catch (error) {
                console.error("âŒ [ERROR] FingerprintJS Error:", error);
                document.getElementById("js-detection").innerText = "FingerprintJS Error: " + error.message;
            }
        }

        // **Sayfa yÃ¼klendiÄŸinde fonksiyonlarÄ± Ã§alÄ±ÅŸtÄ±r**
        document.addEventListener("DOMContentLoaded", async () => {
            await detectBrowser();
            await detectBotD();
        });
    </script>
</body>
</html>
